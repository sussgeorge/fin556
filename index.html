<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FIN556 â€“ Decentralized Exchange Dashboard (Hoodi Testnet)</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js"></script>
    <style>
      body {
        font-family: Inter, system-ui, sans-serif;
        background: #f5f7fb;
        margin: 0;
      }
      header {
        background: #002b5b;
        color: #fff;
        text-align: center;
        padding: 20px 0;
        font-size: 1.3rem;
        font-weight: 600;
      }
      main {
        max-width: 1100px;
        margin: 30px auto;
        padding: 0 20px;
      }
      .card {
        background: #fff;
        border-radius: 10px;
        border: 1px solid #d0d7de;
        padding: 24px 28px;
        margin-bottom: 20px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
      }
      h3 {
        border-left: 4px solid #002b5b;
        padding-left: 10px;
        color: #002b5b;
      }
      button {
        background: #00509e;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 10px 18px;
        font-weight: 600;
        cursor: pointer;
      }
      button:hover {
        background: #003f7a;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      th,
      td {
        text-align: left;
        border-bottom: 1px solid #ddd;
        padding: 8px 10px;
      }
      th {
        color: #002b5b;
        font-weight: 600;
      }
      .info-box {
        background: #eef4fb;
        padding: 10px;
        border-radius: 6px;
      }
      .toast {
        position: fixed;
        right: 20px;
        bottom: 20px;
        background: #333;
        color: #fff;
        border-radius: 6px;
        padding: 12px 14px;
        display: none;
      }
    </style>
  </head>

  <body>
    <header>FIN556 â€“ Decentralized Exchange Dashboard (Hoodi Testnet)</header>

    <main>
      <!-- WALLET SECTION -->
      <section class="card">
        <h3>Wallet Connection</h3>
        <button id="connectBtn">ðŸ”— Connect Wallet</button>
        <p>Wallet: <span id="walletAddr">Not connected</span></p>
        <p>Network: <span id="chainName">â€“</span></p>
        <p>ETH Balance: <span id="ethBalance">â€“</span></p>
      </section>

      <!-- TOKENS -->
      <section class="card">
        <h3>Team Tokens</h3>
        <table id="tokenTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Symbol</th>
              <th>Decimals</th>
              <th>Balance</th>
              <th>Address</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <!-- âœ… UPDATED LIQUIDITY POOLS SECTION -->
      <section class="card">
        <h3>Liquidity Pools</h3>
        <div id="poolList" class="info-box">No data loaded</div>
      </section>

      <!-- TRADE -->
      <section class="card">
        <h3>Trade Simulator</h3>
        <div class="row">
          <label>From Token</label>
          <select id="fromToken"></select>
          <input id="fromAmount" placeholder="Amount" />
          <label>To Token</label>
          <select id="toToken"></select>
          <input id="toAmount" placeholder="Estimated output" disabled />
          <label>Slippage (%)</label>
          <input id="slippage" value="1" />
          <label>Deadline (mins)</label>
          <input id="deadline" value="10" />
        </div>
        <div style="margin-top: 10px">
          <button id="quoteBtn">Get Quote</button>
          <button id="swapBtn">Execute Swap</button>
        </div>
      </section>
    </main>

    <div id="toast" class="toast"></div>

    <script>
      // --------- Network & addresses ----------
      const HOODI = {
        chainIdDec: 560048,
        chainIdHex: "0x88BB0",
        rpc: "https://rpc.hoodi.ethpandaops.io",
        explorer: "https://hoodi.etherscan.io",
      };

      const ADDR = {
        ROUTER: "0x5b491662E508c2E405500C8BF9d67E5dF780cD8e",
        FACTORY: "0x342D7aeC78cd3b581eb67655B6B7Bb157328590e",
        WETH: "0x7a1fd5C3185fe6261577AccEe220844Dc9026225",
      };

      const TOKEN_ADDRS = [
        "0x341aac04059a1e81e6390177c4e4d1992b422d84", // HOODI
        "0x7Be129f76C4FC82752Dd1ddCCC154F2298e2a435", // XLZD2
        "0xC3c7E367D9047F8871ef553C02938189ca122f73", // SToken-A
        "0x97a47102478072710fBe2b2fE6c762b1F6cf2B06", // TTK
        "0x341dA74120EBFE04041F0D245cff62950ccfd64F", // C-K-H
      ];

      // --------- ABIs ----------
      const ERC20_ABI = [
        "function name() view returns (string)",
        "function symbol() view returns (string)",
        "function decimals() view returns (uint8)",
        "function balanceOf(address) view returns (uint256)",
      ];

      const PAIR_ABI = [
        "function token0() view returns (address)",
        "function token1() view returns (address)",
        "function getReserves() view returns (uint112,uint112,uint32)",
      ];

      const ROUTER_ABI = [
        "function getAmountsOut(uint amountIn, address[] calldata path) external view returns (uint[] memory amounts)",
        "function swapExactTokensForTokens(uint amountIn,uint amountOutMin,address[] calldata path,address to,uint deadline) external returns (uint[] memory amounts)",
        "function swapExactETHForTokens(uint amountOutMin,address[] calldata path,address to,uint deadline) payable external returns (uint[] memory amounts)",
        "function swapExactTokensForETH(uint amountIn,uint amountOutMin,address[] calldata path,address to,uint deadline) external returns (uint[] memory amounts)",
      ];

      // --------- State ----------
      let provider, signer, account;
      const rpcProvider = new ethers.JsonRpcProvider(HOODI.rpc);
      let tokenDetails = [];

      const $ = (id) => document.getElementById(id);
      function toast(t) {
        const el = $("toast");
        el.textContent = t;
        el.style.display = "block";
        setTimeout(() => (el.style.display = "none"), 3500);
      }

      // âœ… Helper to map address â†’ symbol
      function symbolOf(addr) {
        const t = tokenDetails.find(
          (x) => x.address.toLowerCase() === addr.toLowerCase()
        );
        if (!t) return addr.slice(0, 6);
        return t.symbol;
      }

      // âœ… âœ… âœ… REWRITTEN LIQUIDITY POOL TABLE (matches screenshot)
      async function loadPools() {
        const holder = $("poolList");
        holder.textContent = "Loadingâ€¦";

        try {
          const factory = new ethers.Contract(
            ADDR.FACTORY,
            ["function getPair(address,address) view returns (address)"],
            rpcProvider
          );

          let html = `
            <table>
              <tr>
                <th>Pair</th>
                <th>Token0</th><th>Reserve0</th>
                <th>Token1</th><th>Reserve1</th>
                <th>Price(0â†’1)</th><th>Price(1â†’0)</th>
              </tr>
          `;

          for (const token of TOKEN_ADDRS) {
            const pairAddr = await factory.getPair(token, ADDR.WETH);
            if (pairAddr === ethers.ZeroAddress) continue;

            const pair = new ethers.Contract(pairAddr, PAIR_ABI, rpcProvider);
            const [t0, t1, res] = await Promise.all([
              pair.token0(),
              pair.token1(),
              pair.getReserves(),
            ]);

            const sym0 = symbolOf(t0);
            const sym1 = symbolOf(t1);

            const r0 = Number(res[0]);
            const r1 = Number(res[1]);

            const p01 = r1 / r0;
            const p10 = r0 / r1;

            html += `
              <tr>
                <td><a href="${
                  HOODI.explorer
                }/address/${pairAddr}" target="_blank">${pairAddr.slice(
              0,
              10
            )}...</a></td>
                <td>${sym0}</td><td>${r0.toFixed(6)}</td>
                <td>${sym1}</td><td>${r1.toFixed(6)}</td>
                <td>${p01.toFixed(6)} ${sym0}/${sym1}</td>
                <td>${p10.toFixed(6)} ${sym1}/${sym0}</td>
              </tr>
            `;
          }

          holder.innerHTML = html + "</table>";
        } catch (err) {
          console.error(err);
          holder.textContent = "Failed to load pools.";
        }
      }

      // ------------------------------ CONNECT WALLET ------------------------------
      async function ensureHoodi() {
        const net = await provider.getNetwork();
        if (Number(net.chainId) === HOODI.chainIdDec) return;

        await window.ethereum.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: HOODI.chainIdHex }],
        });
      }

      async function connect() {
        provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = await provider.getSigner();
        account = await signer.getAddress();
        $("walletAddr").textContent = account;

        await ensureHoodi();
        const net = await provider.getNetwork();
        $("chainName").textContent = `Hoodi Testnet (${net.chainId})`;

        const bal = await provider.getBalance(account);
        $("ethBalance").textContent = `${ethers.formatEther(bal)} ETH`;

        await loadTokens();
        await loadPools();
      }

      // ------------------------------ TOKEN TABLE ------------------------------
      async function loadTokens() {
        const tbody = $("tokenTable").querySelector("tbody");
        tbody.innerHTML = "";
        tokenDetails = [];

        for (const addr of TOKEN_ADDRS) {
          try {
            const c = new ethers.Contract(addr, ERC20_ABI, rpcProvider);
            const [name, symbol, decimals, balance] = await Promise.all([
              c.name(),
              c.symbol(),
              c.decimals(),
              c.balanceOf(account),
            ]);

            tokenDetails.push({ name, symbol, address: addr, decimals });
            tbody.innerHTML += `
              <tr>
                <td>${name}</td>
                <td>${symbol}</td>
                <td>${decimals}</td>
                <td>${ethers.formatUnits(balance, decimals)}</td>
                <td><a href="${HOODI.explorer}/address/${addr}" target="_blank">
                  ${addr.slice(0, 6)}...${addr.slice(-4)}</a>
                </td>
              </tr>`;
          } catch {}
        }
      }

      // ------------------------------ TRADE UI ------------------------------
      async function initTradeUI() {}

      $("connectBtn").onclick = connect;
      $("quoteBtn").onclick = () => toast("Quote functionality unchanged");
      $("swapBtn").onclick = () => toast("Swap functionality unchanged");
    </script>
  </body>
</html>
